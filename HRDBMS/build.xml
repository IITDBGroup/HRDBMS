<project name="HRDBMS" default="createJar" basedir="." xmlns:ivy="antlib:org.apache.ivy.ant">

	<!-- ROOTDIR -->
	<property name="projectroot" value="${basedir}" />

	<!-- TASK DEFS AND IMPORTED LIBRARIES -->
	<taskdef resource="net/sf/antcontrib/antcontrib.properties">
		<classpath>
			<pathelement location="${basedir}/lib/ant-contrib.jar"/>
		</classpath>
	</taskdef>
	
	<!-- DIRECTORIES -->
	<property name="sourcedir" value="${projectroot}/src" />
	<property name="binarydir" value="${projectroot}/bin" />
	<property name="builddir" value="${projectroot}/build" />
	<property name="librarydir" value="${projectroot}/lib" />
	<property name="packagedir" value="${sourcedir}/com/exascale/optimizer" />
	<property name="package" value="com.exascale.optimizer" />
	
	<!-- FILES -->
	<property name="buildjar" value="${builddir}/gprom-jdbc-test.jar" />
	<property name="packagejar" value="${builddir}/HRDBMS.jar" />
	<property name="grammarfile" value="${sourcedir}/com/exascale/optimizer/Select.g4" /> 
	
	<!-- CLASSPATHS -->
	<path id="libraries">
		<fileset dir="${binarydir}">
			<include name="**/*.class"/>
		</fileset>
	</path>
	
	<!-- CLEAN -->
	<target name="clean" depends="">
		<mkdir dir="${builddir}" />
		<mkdir dir="${binarydir}" />
	</target>

	<!-- BUILD -->
 	<target name="resolve" description="--> retrieve dependencies with ivy">
        <ivy:retrieve />
    </target>
	
	<!-- EXTRACT CLASS FILES FOR DEPENDENCIES -->
	<target name="unjarDependencies" depends="clean">
	    <unzip dest="${binarydir}">
	        <fileset dir="${librarydir}">
	            <include name="**/*.jar" />
	        </fileset>    
	    </unzip>
	</target>
	
	<!-- CREATE PARSER -->
	<target name="createParser" depends="unjarDependencies">
		<java classname="org.antlr.v4.Tool" classpathref="libraries">
			 <arg value="${grammarfile}"/>
		</java>
		<!-- TODO -->
		<!-- <antlr target="${sourcedir}/com/exascale/optimizer/Select.g4" >
		</antlr> -->
	</target>
	
	<target name="antlr4-install">
				    <mkdir dir="${antlr4.dir}" />
				    <get src="http://www.antlr.org/download/antlr-4.4-complete.jar" dest="${antlr4.dir}" skipexisting="true"/>
	</target>
	<target name="antlr4-gensrc" depends="antlr4-install" >
	    
	    <java jar="${antlr4.dir}/antlr-4.4-complete.jar" fork="true">
	    <arg line="-package ${package} ${grammarfile} -o ${packagedir}"/>
	    <arg line="-listener -visitor -encoding UTF-8"/>
	    <arg line="-package ${package}"/>
	    </java>
	</target>
	
	<!-- COMPILE SYSTEM -->
	<target name="compile" depends="unjarDependencies">
		<depend srcdir="${sourcedir}"
		        destdir="${binarydir}"
		        cache="depcache"
		        closure="yes"/>
		<javac srcdir="${sourcedir}" destdir="${binarydir}" classpathref="libraries" 
			debug="on" excludes="**/.svn*">
			<compilerarg value="-Xlint:unchecked" />
		</javac>
	</target>

	
	<!-- PACKAGE SYSTEM AS JAR -->
	<target name="createJar" depends="unjarDependencies">
		<jar destfile="${packagejar}" basedir="${binarydir}">
			<manifest>
				<attribute name="Created-By" value="Illinois Institute of Technology, Department for Computer Science" />
			</manifest>
		</jar>
	</target>

	
	
</project>